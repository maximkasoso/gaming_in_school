<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Angry Birds Clone</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const PIG_RADIUS = 30;
        const WOOD_STRENGTH = 1;
        const ICE_STRENGTH = 0.5;
        const STONE_STRENGTH = 2;

        let gameState = {
            level: 1,
            chicken: { x: 100, y: canvas.height - 150, radius: 20, velocityX: 0, velocityY: 0, isLaunched: false },
            targets: [],
            obstacles: [],
            background: '#8B0000',
            theme: 'forest',
            deltaTime: 0,
        };

        function init() {
            generateLevel();
            requestAnimationFrame(gameLoop);
        }

        function generateLevel() {
            // Clear previous level objects
            gameState.targets = [];
            gameState.obstacles = [];

            // Randomize theme for the level
            const themes = ['forest', 'desert', 'swamp', 'icy', 'mountain'];
            gameState.theme = themes[Math.floor(Math.random() * themes.length)];
            setLevelTheme(gameState.theme);

            // Generate structures, pigs, and obstacles for the level
            createRandomStructures();
            createDynamicObstacles();
            createPigs();

            // UI Update (like score, level, etc.)
            updateUI();
        }

        function createRandomStructures() {
            const structureTypes = ['pyramid', 'tower', 'bridge', 'bunker'];
            const structureType = structureTypes[Math.floor(Math.random() * structureTypes.length)];
            const x = Math.random() * 500 + 300;
            const y = Math.random() * 300 + 100;
            createStructure(x, y, structureType, Math.floor(Math.random() * 3) + 3);
        }

        function createStructure(x, y, type, size) {
            // Generate blocks for the structure (you can enhance this with images or animations)
            const blockWidth = 50;
            const blockHeight = 50;
            for (let i = 0; i < size; i++) {
                gameState.obstacles.push({
                    x: x + (i * blockWidth),
                    y: y,
                    width: blockWidth,
                    height: blockHeight,
                    health: Math.floor(Math.random() * 3) + 1,
                    type: 'wood',
                    rotation: Math.random() * Math.PI * 2,
                });
            }
        }

        function createDynamicObstacles() {
            const obstacleTypes = ['wood', 'ice', 'stone'];
            const obstacleCount = Math.floor(Math.random() * 5) + 3;
            for (let i = 0; i < obstacleCount; i++) {
                const material = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
                const x = Math.random() * 600 + 200;
                const y = Math.random() * 300 + 100;
                let strength = WOOD_STRENGTH;
                if (material === 'ice') strength = ICE_STRENGTH;
                if (material === 'stone') strength = STONE_STRENGTH;

                gameState.obstacles.push({
                    x: x,
                    y: y,
                    width: 40 + Math.random() * 40,
                    height: 40 + Math.random() * 40,
                    health: strength,
                    type: material,
                    rotation: Math.random() * Math.PI * 2,
                });
            }
        }

        function createPigs() {
            const pigCount = 3 + Math.floor(gameState.level * 1.5);
            for (let i = 0; i < pigCount; i++) {
                const pigX = Math.random() * 600 + 200;
                const pigY = Math.random() * 300 + 100;
                gameState.targets.push({
                    x: pigX,
                    y: pigY,
                    radius: PIG_RADIUS,
                    health: 1,
                    type: 'pig',
                });
            }
        }

        function setLevelTheme(theme) {
            // Set background, obstacles, and pig appearance based on theme
            switch (theme) {
                case 'forest':
                    gameState.background = '#228B22';
                    break;
                case 'desert':
                    gameState.background = '#F4A300';
                    break;
                case 'swamp':
                    gameState.background = '#556B2F';
                    break;
                case 'icy':
                    gameState.background = '#ADD8E6';
                    break;
                case 'mountain':
                    gameState.background = '#A9A9A9';
                    break;
            }
        }

        function updateUI() {
            // Update level, score, etc.
            console.log(`Level: ${gameState.level}, Theme: ${gameState.theme}`);
        }

        function gameLoop(timestamp) {
            if (!gameState.lastTime) gameState.lastTime = timestamp;
            gameState.deltaTime = (timestamp - gameState.lastTime) / 1000;
            gameState.lastTime = timestamp;

            // Clear canvas and set background
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = gameState.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw and update objects
            drawObstacles();
            drawTargets();
            drawChicken();

            // Update physics (if chicken is launched)
            if (gameState.chicken.isLaunched) {
                gameState.chicken.velocityY += 0.1; // Gravity
                gameState.chicken.x += gameState.chicken.velocityX * gameState.deltaTime;
                gameState.chicken.y += gameState.chicken.velocityY * gameState.deltaTime;
            }

            // Request next frame
            requestAnimationFrame(gameLoop);
        }

        function drawObstacles() {
            gameState.obstacles.forEach(obstacle => {
                ctx.save();
                ctx.translate(obstacle.x, obstacle.y);
                ctx.rotate(obstacle.rotation);
                ctx.fillStyle = obstacle.type === 'wood' ? '#8B4513' : obstacle.type === 'stone' ? '#808080' : '#B0E0E6';
                ctx.fillRect(-obstacle.width / 2, -obstacle.height / 2, obstacle.width, obstacle.height);
                ctx.restore();
            });
        }

        function drawTargets() {
            gameState.targets.forEach(target => {
                ctx.beginPath();
                ctx.arc(target.x, target.y, target.radius, 0, Math.PI * 2);
                ctx.fillStyle = '#FF0000';
                ctx.fill();
            });
        }

        function drawChicken() {
            ctx.beginPath();
            ctx.arc(gameState.chicken.x, gameState.chicken.y, gameState.chicken.radius, 0, Math.PI * 2);
            ctx.fillStyle = '#FFFF00';
            ctx.fill();
        }

        // Launch chicken
        canvas.addEventListener('mousedown', (e) => {
            if (!gameState.chicken.isLaunched) {
                const angle = Math.atan2(e.clientY - gameState.chicken.y, e.clientX - gameState.chicken.x);
                const power = 15;
                gameState.chicken.velocityX = Math.cos(angle) * power;
                gameState.chicken.velocityY = Math.sin(angle) * power;
                gameState.chicken.isLaunched = true;
            }
        });

        // Start the game
        init();
    </script>
</body>
</html>
